# 蓝莺IM SDK 更新记录

蓝莺IM，是由[美信拓扑](https://www.lanyingim.com/)团队研发的新一代即时通讯云服务，SDK 设计简单集成方便，服务采用云原生技术和多云架构，私有云也可按月付费。

### 3.0.12 20240807
1.修复群组内只能看到自己的消息看不到其他人发送消息的问题。
2.修改群组内@消息列表的处理逻辑，@列表展示用户名支持群内隐藏消息，@消息内容同步支持使用群隐藏用户名。
3.群组内对于群隐藏用户，即没有设置群昵称及个人昵称的用户。自己的用户名也展示为隐藏用户名。
4.修复群组内已读消息处理后展示的未读数清除很慢的问题。
5.修复错误的 meta 数据导致的 link 用户界面重刷新的问题。
6.修改 link support 在 iframe 的情况下切换账户时的逻辑处理，保证正常切换用户，切换过程中导航至 loading 界面，输入错误的情况下能正常自动注册新账户完成登录。

### 3.0.11 20240806
1.移除用户设置别名相关的展示机操作接口，针对联系人只保留昵称、用户名和 id信息。
2.更新选择切换按钮的样式。
3.修改群组隐藏详细的设计逻辑，用户设置了群昵称及个人昵称的情况下仍然使用设置的信息，只有使用用户名的情况下才进行隐藏。
4.修改群组设置页面的群用户名称展示逻辑，保证设置界面也可以正常使用隐藏群信息的用户名逻辑。
5.针对用户名密码错误的场景修改尝试自动登录时频繁弹出alert 错误提示的问题，改为使用Element 消息提示方式，减少客户手动点击频率。
6.修改 appid 输入错误的情况下 dns 的报错逻辑处理，保证登录时显著提示 appid 设置错误。
7.移除群组header信息栏中无用的@消息提示。
8.floo web sdk中新增禁言群用户的处理逻辑。
9.修改群组聊天框中输入栏的处理逻辑，可以正常的展示被禁言及收到长链接禁言通知后可以正确显示禁言状态。

### 3.0.10 20240730
1.区分 link support 的使用场景，针对 iframe 嵌入使用客服场景和蓝莺 link 场景下，使用不同的界面初始化逻辑，保证界面加载都正常。
2.修复 link support 页面在 ios 移动端浏览器环境下点击弹出输入框时页面自动放大的问题。
3.修复 页面存储账号信息在从明文模式切换到加密模式时可能出现的兼容问题。
4.优化 link support 页面在导航条模式下收起按钮的样式。
5.修复群组黑名单操作或者删除群成员后出现的整个用户所有群成员列表清空的bug。
6.修复群组设置界面群成员过多不能正常展示群设置弹出窗口的问题。
7.修改群组设置界面设置及展示群公告的样式。
8.修改群组设置界面操作处理后选择的选项没有被清空的问题。
9.修改群组共享文件的操作处理界面的样式。
10.修改群组设置界面的禁言设置操作展示，被禁言的状态的成员使用红色展示。

### 3.0.9 20240727
1.修改 link support 页面的微信内置浏览器跳转处理，在手机端和电脑端使用不同处理方式。
2.修改 link support 页面的默认加载样式，在 PC 端默认加载为导航条，在移动端默认为一个浮层按钮。
3.修复 link support 页面在 safari 端默认打开时闪烁问题及打开窗口尺寸不正确的问题。
4.修改 link support 页面导航条模式下默认的展示样式。
5.修复 link support 页面在微信内置浏览器下会自动跳转到微信小程序欢迎界面问题。
6.link support 页面默认读取后台的配置文件，根据后台配置文件参数展示导航条的界面、图标及弹出层的展示。
7.修改link support 页面默认打开其它会话位置，将打开其它会话加载到下拉菜单中，同时增加会话消息未读数展示。
8.link support 页面新增其它会话新到达消息的提醒处理，使用弹出框和闪烁未读数来提示新消息到达。
9.优化 link support 输入框展示样式，使用消息发送按钮来区分输入框内是否有内容。
10.按照 floo 移动端逻辑优化了 floo web 端流式消息的展示逻辑。
11.优化 dns 获取逻辑，在每次使用本地存储 dns 后后台自动下载一次最新的服务器 dns 配置文件。
12.修复私有部署环境下音视频单聊不能正常通话的问题。
13.floo sdk 新增获取 app config和群组设置是否对普通群成员隐藏其它群成员详情功能。
14.floo web 新增设置群组是否对普通群成员隐藏其它群成员详情功能及隐藏状态下使用加密方式展示用户信息功能。

### 3.0.8 20240610
1.floo sdk增加异步更改用户密码接口。
2.support增加loading页面。
3.移除web端无用的电话号码设置功能。
4.floo web增加群组聊天界面@提示功能。
5.修复floo sdk解析rtc信令时可能出现解析错误导致崩溃的问题。
6.修复部分界面逻辑错误bug。
7.修复转发消息不可用的bug。
8.修改转发列表展示样式。
9.修复群聊不能撤回消息及不能执行消息删除的问题。
10.群组增加群管理员和群主可以撤回普通成员发送消息的功能。
11.link support页面新增聊天切换功能（支持support页面展示单聊及群聊会话）。
12.增加link support页面头像点击浮窗展示用户及群组的详细信息。
13.修改link support页面在PC端网页中的展示功能，PC端展示有微信小程序扫码登录功能，下拉列表中支持已有账号登录，打开完整版及打开客户端功能。
14.修改link support页面在mobile网页中的展示功能，点击唤醒微信小程序功能，下拉列表中支持支持已有账号登录，打开完整版及打开客户端功能。
15.修改link support页面在微信浏览器网页中的展示功能，点击唤醒微信小程序功能，下拉列表中支持支持已有账号登录及打开完整版功能。
16.修复ios无法检测软件是否安装及不安装情况下无法自动打开软件市场的问题。
17.修复safari浏览器在iframe中无法唤醒app及无法唤醒微信小程序的功能。
18.floo web中新增多tab中支持多个账号同时登录的功能。
19.floo web端退出登录操作逻辑修改，支持退出时同时退出所有web端和只退出当前登录网页端功能。
20.去除link support的网页安全范围限制，所有加载link的父窗口均可传递信息给link support页面。
21.修改link support页面左下角的appid展示方式，使用提示图标鼠标悬停后弹出悬浮窗的方式展示appid。
22.修改floo web的当前登录用户及已登录用户列表的信息存储方式，使用固定的加密key将用户名和密码加密存储。

### v3.0.7 20240207
1.修改markdown格式中table的展示，确保table展示样式正确。
2.增加多账号切换登录功能。
3.修改support页面slogan的样式，确保slogan能一直展示完整。
4.修改floo web页面二维码扫描输出内容及格式，与app和小程序保持一致。
5.修复修改昵称是导航条中展示名字不同步变更的问题。
6.修复会话列表中横向滚动条在safari和firefox浏览器中会一直出现的问题。
7.修复会话中最新消息为流式消息时，消息内容只有流式消息第一段内容的问题。
8.修复第一次登录时会话列表中的第一条内容展示为会话最新消息而不是最老的一条消息的问题。
9.支持safari浏览器在iframe子页面嵌入support页面时父页面与子页面无法保持账号统一的问题，在父子两个页面都存储了账户信息且进行同步。
10.增加当前APP用户数已达上限时提示请使用已有账号登录或联系管理员开通商业版。
11.修复support页面snackbar提示时出现闪缩和出现位置错乱的问题。
12.修复对话框头部偶尔不能展示好友或者群组名称导致的不能查看对方profile的问题。
13.设置页面及查看对方profile页面新增展示昵称及设置昵称功能。
14.修复群profile页面在群名片为空时不能设置或修改的问题。
15.修复用户设置群名片限制，任何用户都允许设置自己的群名片。
16.修复用户名过长时群成员列表展示位置错乱的问题。
17.修复群成员列表不能滑动的问题。
18.移除消息输入框中无用的type a message提示。
19.修改@消息的弹出列表式样。
20.修复onRosterInfoUpdate处理时rosterId操作错误导致的设置当前用户自己的别名的问题。
21.增加asyncUpdateRosterAlias接口。
22.使用 用户别名 > 用户昵称 > 用户名 > 用户id的展示顺序来展示用户名。
23.在群组内使用 用户别名 > 用户群名片 > 用户昵称 > 用户名 > 用户id的展示顺序来展示用户名。
24.在联系人profile界面新增用户别名展示。
25.修复groupInfoUpdate处理群成员昵称变更时误将变更处理群组信息而不是具体的群成员信息的问题。
26.修复消息列表中删除非最后一天消息时出现的删除消息后消息列表展示错乱的问题。
27.修复群聊内@消息的展示格式不正确及@消息的消息操作标签展示位置不正确的问题。
28.修复群组内历史消息会出现流式渲染的问题。

### v3.0.6 20240119
1.修复流式消息输出速度不均匀及展示位置会错乱的问题。
2.修复markdown 格式消息展示时会输出 html 未闭合标签的问题。
3.增加流式消息最长输出时间限制，消息片段最长 20s 内输出完毕。
4.设置消息渲染最短间隔时间为 40ms，优化消息展示效果。
5.优化消息第一段内没有 markdown 格式，之后消息片段到达时从文本流式消息转换为 markdown 流式消息的展示效果，防止markdown 从头开始渲染。
6.修改自动下拉逻辑，在展示时间超过消息片段间隔时，设置实际展示时间长度为自动下拉长度。

### v3.0.5 20240117
1.修复流式消息在展示是重复清空消息导致的展示错乱问题。
2.修复大页面环境下输入框不能完全覆盖底层输入框区域问题。
3.修复sdk 读取本地缓存消息为空时没有判定导致的读写错误。
4.修改 support 样式，支持展示 appid。
5.增加 support 网页在微信浏览器下唤醒小程序功能。

### v3.0.4 20231127
1.修改音视频信令逻辑，新增 rtc record 指令用于展示通话记录。
2.修改 sdk 处理 rtc 信令逻辑，sdk 中只存储 rtc record 信令，其它 rtc 信令不保存。
3.修改 sdk 处理 会话最新消息逻辑，过滤 rtc 非 record 消息，确保 conversation 中会话最新消息不会展示其它 rtc 消息。
4.修改音视频通话 janus 信令执行流程，会话发起端在接收到对方的 pickup 消息之后才会开始加入房间等后续逻辑处理，在两端都发布流之后才正式进入通话状态。
5.修改通话接收端逻辑，接收端同样使用 initRTCEngine 初始化音视频环境，初始化后执行 joinRoom 执行加入房间逻辑。
6.修改对端音视频流检测逻辑，检测到对端异常结束流发布后自动执行挂断操作。
7.通话建立之前，通话界面仅挂断按钮有效，屏蔽其它按键操作。
8.通话建立之前，使用本地渲染来展示本地视频展示。
9.修改支持页面启动会话页面逻辑，使用服务器返回凭证获取用户信息进行登录，确保 safari 浏览器多tab 页面下使用相同账户登录。
10.增加延迟启动音视频通话逻辑，确保过滤该设备历史离线队列中多设备支持其他端同步的历史通话消息唤醒音视频呼叫。

### v3.0.3 20231020
1.修复历史消息获取的流式消息仍然使用流式消息展示的问题。
2.文本消息新增功能按钮可以展示消息的扩展信息。
3.修复AI同时回复多条消息时出现的消息展示错乱问题。
4.support页面新增参数确保safri跳转聊天时使用同一个账号。
5.support页面新增其它会话未读数展示功能。
6.调整markdown信息展示格式及support页面展示格式。

### v3.0.2 20231008
1.单聊、群聊及LinkChat界面增加流式消息展示功能。

### v3.0.1 20230918
1. 单聊、群聊及LinkChat界面增加markdown格式消息解析及展示功能。

### v3.0.0 20230617
1. 单聊新增1v1音视频功能。

### v2.9.20 20230424

1. 修复LinkChat页面未显示对方昵称的Bug;

### v2.9.19 20230422

1. 使用CSS控制响应式布局实现，防止窗口Resize引起重登录；
2. 蓝莺LinkChat预览版发布；
3. 修改图片和文件图标，增加Tooltip;

### v2.9.17 20230310
1. 修复webim.cleanup调用后有些key没被删除的bug

### v2.9.16 20230309
1. 修复storeBase分区对partition_key等于0的情况不一致的问题

### v2.9.15 20230118
1. 修复noticeStore.saveNotice报错问题

### v2.9.13 20230114
1. 修复退出群不会触发onGroupMemberChanged事件的问题

### v2.9.12 20230104

1. 支持设置sdk日志等级;
2. 通讯录页面增加客服列表

### v2.9.11 20220802

1. 修复删除会话后不会收到删除会话事件的问题；
2. 增加好友申请事件通知（onRosterApplied）；
3. 修复退出并登录新用户时，可能会加载旧用户的数据的问题；

### v2.9.10 20211206

1. 重要：Websocket 禁用 polling，解决浏览器后台切换后自动重连慢问题；
2. Fix Bug: 在未取用户信息的时候返回有效的空 RosterInfo；
3. 支持修改群扩展信息；
4. 支持群成员全体禁言；
5. 消息发送状态事件增加消息 id；

### v2.9.9 20210811

1. 收取历史消息不需要额外通知；
2. Fix Bug: 获取 roster 失败引发 socket 初始化失败，将会导致 disConnect 时候异常；

### v2.9.8 20210801

1. Fix Bug: 好友信息更新时间应该使用 onRosterInfoUpdate；
2. Fix Bug: 自动登录未正确设置 isLogin，导致同一用户会出现两次登录；
3. Demo bug fix: 好友信息变化后不再触发花名册更新，后者将会在处理不存在用户时引发循环请求；
4. Demo: 显示花名册好友昵称；
5. Demo: 持久化存储 AppID，页面刷新后依然使用上次设置 AppID；

### v2.9.7 20210728

1. Fix Bug: 收到 userNotice 后退出并不再重连；
2. Demo：增加 userNotice 演示；
3. Demo bug fix: 退出登录另一账号后，会话页面消息显示错误判断是否为自己发送；

### v2.9.6 20210723

1. 优化登陆速度至 100ms 以内；
2. Demo：由于登陆速度过快，需要在初始化函数内立即注册监听，否则会丢失登陆成功通知；

### v2.9.5 20210303

1. 限制获取同一 ID 的好友信息频次，一秒内只能发起一次；
2. Fix bug: 群聊信息默认 status 不应为 UNREAD；

### v2.9.4 20210113

1. 支持从服务端获取消息已读未读状态；
2. 与 Uniapp 同步版本；
3. 支持发送定位消息，type: location；
4. Fix bug：偶现情况下 token 失效上报事件使用了 loginFailure 而不是 loginFail；
5. Demo：演示发送定位信息；
6. Demo: 调整未读数显示位置；
7. Demo fix bug: 单聊时不显示自己头像；
8. Demo fix bug：发送消息后显示已读；

### v2.9.3 20210111

1. 使用 prettier 格式化工程；
2. Demo bug fix：修改 AppID 后不初始化；

### v2.9.2 20210110

1. 支持单独获取消息已读未读状态；
2. Fix bug：退出登录后遗留数据清理；
3. Demo: 退出后清理个人 Profile；
4. Demo: 重构历史消息合并逻辑；

### v2.9.1 20210107

1. 私有云文件发送 Bug；
2. Demo: 显示图片原图以及视频封面；

### v2.8.2 20201103

1. 增加 SDK 初始化状态判断方法 im.isReady，并增加示例等待 SDK 初始化成功；
2. 为会话 last message 增加 ext 字段；
3. 重构 ack 存储，修复事件 onUnreadChange；
4. Fix bug: 发送者不应该发送 READ_ACK；
5. 获取历史消息可指定条数：

### v2.8 20200924

1. 适配 v2 DNS 服务，支持国外加速节点；
2. 冻结用户和 LICENSE 相关错误不再触发重新登录；

### v2.7.2 20200915

1. 优化服务 DNS 刷新机制；
2. 增加自定义协议支持，ext 字段解析；
3. 删除会话前增加存在性检查；
4. Websocket 链接出错后回收关闭；
5. Demo：演示自定义协议；
6. Demo: 添加自动登录逻辑；

### v2.7.1 20200903

1. 优化重连策略，在网络不稳定情况下冷却重连超时；
2. 弱网情况下调整最大连接超时为 90s，延迟登陆时间 10s；

### v2.7 20200825 七夕快乐

1. 支持删除远程会话；
2. 删除会话操作从 im 挪到 im.sysManage；
3. Demo：删除好友/群也会触发删除会话；
4. 性能优化：历史聊天记录不再触发 ReadAck；
5. 支持内嵌在原生 App 中使用厂商推送，可绑定/解绑 DeviceToken;

### v2.5 20200809

！此次更新涉及数据格式变化，升级注意清空本地缓存

1. 支持删除本地会话；
2. 重构 message 存储，增加分区，极大地提高了性能；

### v2.4 20200730

1. 统一事件通知，增加 flooNotice，dnsError 移到 flooError；
2. 增加用户被封禁登陆失败通知 USER_BANNED；
3. 同步发布 Uniapp 版本；
4. 适配修改，多端版本统一；

### v2.3.5 20200629

1. 演示用户自定义协议，即消息 ext 字段使用；

### v2.3.4 20200522

1. 修改说明文档，解释 sourceType: 'unambiguous' 的重要性；

### v2.3.3 20200430

1. fix bug：视频图片显示路径问题；

### v2.3 20200428

1. 提高文件访问地址 URL 的安全性；
2. 同步小程序解决音频播放问题；

### v2.2 20200425

1. 单独显示系统通知；
2. 演示群组设置；
3. 优化：把 refreshServers 从 io 挪到 dnsManange 里；

### v2.1 20200306

1. 发布使用 2.0 库；
2. 重构存储，合并小程序版本 SDK；

### v1.1 20200225

1. 为聊天室消息增加优先级；

### v1.0 20200223 正式发布

1. 支持单聊、群聊；
2. 支持文本、语音（微信小程序）、图片和视频消息；
3. 支持个人信息、头像；
4. 支持自定义协议；
5. 对接蓝莺IM 云服务，设置 appid；
